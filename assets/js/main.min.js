var url=location.href;function regKorisnika(){var a=$("#tbIme").val().trim(),i=$("#tbPrezime").val().trim(),e=$("#tbKorisnickoIme").val().trim(),t=$("#tbEmail").val().trim(),o=$("#tbLozinka").val().trim(),r=$("input[name='pol']:checked").val(),n=[];/^[A-ZŠĐĆŽČ][a-zšđčćž]{2,19}(\s[A-ZŠĐČĆŽ][a-zšđčćž]{2,19})*$/.test(a)?($("#tbIme").next().html(""),$("#tbIme").next().removeClass("red")):($("#tbIme").next().html("Ime nije u dobrom formatu.Mora da počne velikim slovom i minimalan broj karaktera je 3 maksimalan 20 po imenu."),$("#tbIme").next().addClass("red"),n.push("Ime nije u dobrom formatu.")),/^[A-ZŠĐČĆŽ][a-zšđčćž]{2,29}(\s[A-ZŠĐČĆŽ][a-zšđčćž]{2,29})*$/.test(i)?($("#tbPrezime").next().html(""),$("#tbPrezime").next().removeClass("red")):($("#tbPrezime").next().html("Prezime nije u dobrom formatu.Mora da počne velikim slovom i minimalan broj karaktera je 3 maksimalan 30 po prezimenu."),$("#tbPrezime").next().addClass("red"),n.push("Prezime nije u dobrom formatu")),/^[\w\d\.\-\_\&]{5,60}$/.test(e)?($("#tbKorisnickoIme").next().html(""),$("#tbKorisnickoIme").next().removeClass("red")):($("#tbKorisnickoIme").next().html("Korisničko ime nije u dobrom formatu.Minimalan broj karaktera je 5."),$("#tbKorisnickoIme").next().addClass("red"),n.push("Korisničko ime nije u dobrom formatu.")),/^[a-z][a-z\d\.\-\_]+\@[a-z\d]+(\.[a-z]{2,4})+$/.test(t)?($("#tbEmail").next().html(""),$("#tbEmail").next().removeClass("red")):($("#tbEmail").next().html("Email nije u dobrom formatu.Primer dijana.radovanovic.10.18@ict.edu.rs"),$("#tbEmail").next().addClass("red"),n.push("Email nije u dobrom formatu")),/^[\d\w\.\_\-\*\/]{6,40}$/.test(o)?($("#tbLozinka").next().html(""),$("#tbLozinka").next().removeClass("red")):($("#tbLozinka").next().html("Lozinka nije u dobrom formatu.Minimalan broj karaktera je 6."),$("#tbLozinka").next().addClass("red"),n.push("Lozinka nije u dobrom formatu.")),r?($("#tbPolGreska").next().html(""),$("#tbPolGreska").next().removeClass("red")):($("#tbPolGreska").next().html("Morate izabrati pol."),$("#tbPolGreska").next().addClass("red"),n.push("Pol je obavezan podatak")),n.length||($("#poruka").html(""),$.ajax({url:"modules/registracija.php",method:"post",dataType:"json",data:{ime:a,prezime:i,korisnickoIme:e,email:t,lozinka:o,pol:r,dugme:!0},success:function(a,i,e){$("#poruka").html("<p>Uspešno ste se registrovali</p>")},error:function(a,i,e){var t="Došlo je do greške.";switch(a.status){case 404:t="Stranica nije pronađena.";break;case 409:t="Email već postoji. ";break;case 422:t=" Podaci nisu validni. ";break;case 500:t=" Greška. "}$("#poruka").html(t)}}))}function ispisiKorisnike(){$.ajax({url:"modules/korisnici/dohvatiSve.php",method:"post",dataType:"json",success:function(a){$("#tabelaSaKorisnicima").html(dohvatiSve(a)),$(".izbrisi").click(izbrisiKorisnika),$(".azuriraj").click(azuriraj),$("#skloni").click(function(){$("#podaciKorisnik").slideUp()})},error:function(a,i,e){var t="Došlo je do greške.";switch(a.status){case 404:t="Stranica nije pronađena.";break;case 500:t=" Greška. "}alert(t)}})}function dohvatiSve(a){let i=1,e='<table class="table table-bordered">\n    <thead>\n      <tr>\n        <th scope="col">Redni broj</th>\n        <th scope="col">Ime</th>\n        <th scope="col">Prezime</th>\n        <th scope="col">Korisničko ime</th>\n        <th scope="col">Uloga</th>\n        <th scope="col">Izbriši</th>\n        <th scope="col">Ažuriraj</th>\n      </tr>\n    </thead>\n    <tbody>';for(let t of a)e+=`\n        <tr>\n      <th scope="row">${i++}</th>\n      <td>${t.ime}</td>\n      <td>${t.prezime}</td>\n      <td>${t.korisnicko_ime}</td>\n      <td>${t.nazivUloge}</td>\n      <td><a href="#" data-idkorisnika="${t.idKorisnik}" class="izbrisi"><i class="fa fa-trash" aria-hidden="true"></i></a></td>\n      <td><a href="#" data-idkorisnika="${t.idKorisnik}" class="btn btn-outline-secondary azuriraj">Ažuriraj</a></td>\n    </tr>\n        `;return e+="</tbody>\n        </table>"}function izbrisiKorisnika(a){a.preventDefault();let i=$(this).data("idkorisnika");console.log(i),$.ajax({url:"modules/korisnici/izbrisi.php",method:"post",data:{idKorisnika:i},success:function(a){ispisiKorisnike()},error:function(a,i,e){var t="Došlo je do greške.";switch(a.status){case 404:t="Stranica nije pronađena.";break;case 409:t="Nije moguće izbrisati korisnika.";break;case 500:t=" Greška. "}alert(t)}})}function azuriraj(a){a.preventDefault(),$("#podaciKorisnik").slideDown();var i=$(this).data("idkorisnika");console.log(i),$.ajax({url:"modules/korisnici/dohvatiKorisnika.php",method:"post",dataType:"json",data:{idKorisnika:i},success:function(a){$("#tbIme").val(a.ime),$("#tbPrezime").val(a.prezime),$("#tbKorisnickoIme").val(a.korisnicko_ime),$("#tbEmail").val(a.email),$("#ddlUloga").val(a.idUloga),console.log($("#ddlUloga").val()),$("input[name='chbAktivan']").removeAttr("checked"),1==a.aktivan&&$("input[name='chbAktivan']").attr("checked",!0),$("input[name='pol']").each(function(){$(this).val()==a.pol&&$(this).attr("checked",!0)});var i=a.datum_registracije.split(" ");$("#datum").val(i[0]),$("#idKorisnika").val(a.idKorisnik)},error:function(a,i,e){var t="Došlo je do greške.";switch(a.status){case 404:t="Stranica nije pronađena.";break;case 500:t=" Greška. "}alert(t)}})}function sviProizvodi(){$.ajax({url:"modules/proizvodi/filtriranjeSortiranje.php",method:"post",dataType:"json",data:{id:1,idKategorije:0,idZaSort:0,dugme:!0},success:function(a){ispisiProizvode(a)},error:function(a,i,e){var t="Došlo je do greške.";switch(a.status){case 404:t="Stranica nije pronađena.";break;case 500:t=" Greška. "}alert(t)}})}function ispisiProizvode(a){let i="";for(let e of a)i+=`\n        <div class="col-md-2 col-sm-6 col-xs-12 mt-5 okvir m-3 p-2">\n        <a href="${e.slikaOrg}" data-lightbox="ourgallery">\n        <img src="${e.slikaNap}" class="img-fluid" alt="${e.naziv}"/>\n        </a>\n        <p class="text-center">${e.naziv}</p>\n        <p class="text-center">${e.cena} RSD</p>\n        <div class="col-12 d-flex justify-content-center">\n        <a href="index.php?page=proizvod&id=${e.idProizvod}" class="btn btn-outline-secondary" data-idProizvoda="${e.idProizvod}">Vidi proizvod</a>\n        </div>\n        </div>\n        `;$("#sviProizvodi").html(i),$("#stranicenje").show()}function stranicenje(a){$.ajax({url:"modules/proizvodi/stranicenje.php",method:"post",dataType:"json",data:{id:a},success:function(a){let i="",e=a.brojProizvoda,t=Math.ceil(e/3);for(let a=1;a<t;a++)i+=1==a?`<li class='active'><a href="#" class="btn btn-outline-secondary strana" data-id="${a}">${a}</a></li>`:`<li><a href="#" class="btn btn-outline-secondary strana" data-id="${a}">${a}</a></li>`;$("#stranicenje2").html(i)},error:function(a,i,e){var t="Došlo je do greške.";switch(a.status){case 404:t="Stranica nije pronađena.";break;case 500:t=" Greška. "}alert(t)}})}function ispisiProizvodeTabelarno(){$.ajax({url:"modules/proizvodi/proizvodi.php",method:"post",dataType:"json",success:function(a){$("#tabelaSaProizvodima").html(proizvodiUTabeli(a)),$(".azurirajProizvod").click(azurirajProizvod),$("#ukloni").click(function(){$("#azurirajProizvod").hide()}),$(".izbrisiProizvod").click(izbrisiProizvod)},error:function(a,i,e){var t="Došlo je do greške.";switch(a.status){case 404:t="Stranica nije pronađena.";break;case 500:t=" Greška. "}alert(t)}})}function proizvodiUTabeli(a){let i=1,e='<table class="table table-bordered mt-5 pt-5 mb-5">\n    <thead>\n      <tr>\n        <th scope="col">Redni broj</th>\n        <th scope="col">Naziv</th>\n        <th scope="col">Kategorija</th>\n        <th scope="col">Slika proizvoda</th>\n        <th scope="col">Cena</th>\n        <th scope="col">Izbriši</th>\n        <th scope="col">Ažuriraj</th>\n        \n      </tr>\n    </thead>\n    <tbody>';for(let t of a)console.log(a),e+=`\n        <tr>\n      <th scope="row">${i++}</th>\n      <td>${t.naziv}</td>\n      <td>${t.nazivKategorija}</td>\n      <td><img src="${t.slikaNap}" alt="${t.naziv}" id="slikaAdmin"/></td>\n      <td>${t.cena}</td>\n      <td><a href="#" data-idProizvoda="${t.idProizvod}" data-postojeca="${t.slikaOrg}" data-nova="${t.slikaNap}"class="izbrisiProizvod"><i class="fa fa-trash" aria-hidden="true"></i></a></td>\n      <td><a href="#" data-idProizvoda="${t.idProizvod}" data-postojeca="${t.slikaOrg}" data-nova="${t.slikaNap}"  class="btn btn-outline-secondary azurirajProizvod">Ažuriraj</a></td>\n    </tr>\n        `;return e+="</tbody>\n        </table>"}function azurirajProizvod(a){a.preventDefault(),$("#azurirajProizvod").show();var i=$(this).data("idproizvoda");console.log(i),$.ajax({url:"modules/proizvodi/proizvod.php",method:"post",dataType:"json",data:{idProizvoda:i},success:function(a){$("#tbNaziv").val(a.naziv),$("#tbCena").val(a.cena),$("#tbSastav").val(a.sastav),$("#idProizvoda").val(a.idProizvod),$("#ddlKategorija").val(a.idKategorija),$("#putanjaOriginal").val(a.slikaOrg),$("#putanjaNova").val(a.slikaNap),$("#prikazSlike").attr("src",a.slikaNap),$("#prikazSlike").attr("alt",a.naziv);let i=a.datum.split(" ");$("#azDatum").val(i[0])},error:function(a,i,e){var t="Došlo je do greške.";switch(a.status){case 404:t="Stranica nije pronađena.";break;case 500:t=" Greška. "}alert(t)}})}function izbrisiProizvod(a){a.preventDefault();let i=$(this).data("idproizvoda");console.log(i);let e=$(this).data("postojeca");console.log(e);let t=$(this).data("nova");console.log(t),$.ajax({url:"modules/proizvodi/izbrisiProizvod.php",method:"post",dataType:"json",data:{idProizvoda:i,postojeca:e,nova:t},success:function(a){ispisiProizvodeTabelarno()},error:function(a,i,e){var t="Došlo je do greške.";switch(a.status){case 404:t="Stranica nije pronađena.";break;case 409:t="Nije moguće izbrisati korisnika.";break;case 500:t=" Greška. "}alert(t)}})}function ispisNeprocitanihMejlova(){$.ajax({url:"modules/email/neprocitaniMejlovi.php",method:"post",dataType:"json",success:function(a){$("#mejlovi").html(neprocitanEmail(a)),$(".procitan").click(procitan),$("#prikaziProcitane").click(prikaziProcitaneEmail),$("#detaljiMejla").hide(),$(".detaljiEmail").click(prikaziDetaljeEmail),$(".izbrisiEmail").click(izbrisiEmail)},error:function(a,i,e){var t="Došlo je do greške.";switch(a.status){case 404:t="Stranica nije pronađena.";break;case 500:t=" Greška. "}alert(t)}})}function prikaziProcitaneEmail(){$.ajax({url:"modules/email/procitaniMejlovi.php",method:"post",dataType:"json",success:function(a){$("#mejlovi").html(procitaniMejlovi(a)),$(".procitan").click(procitan),$("#neprocitanEmail").click(ispisNeprocitanihMejlova),$("#detaljiMejla").hide(),$(".detaljiEmail").click(prikaziDetaljeEmail),$(".izbrisiEmail").click(izbrisiEmail)},error:function(a,i,e){var t="Došlo je do greške.";switch(a.status){case 404:t="Stranica nije pronađena.";break;case 500:t=" Greška. "}alert(t)}})}function neprocitanEmail(a){let i=1,e='<table class="table table-bordered">\n    <thead>\n      <tr>\n        <th scope="col">Redni broj</th>\n        <th scope="col">Email</th>\n        <th scope="col">Svrha poruke</th>\n        <th scope="col">Poruka</th>\n        <th scope="col">Datum</th>\n        <th scope="col">Izbriši</th>\n        <th scope="col">Detalji email</th>\n        <th scope="col"><a href="#" id="prikaziProcitane">Prikaži pročitane</a></th>\n      </tr>\n    </thead>\n    <tbody>';for(let t of a)e+=`\n        <tr>\n      <th scope="row">${i++}</th>\n      <td>${t.email}</td>\n      <td>${t.svrha}</td>\n      <td>${t.poruka}</td>\n      <td>${t.datum}</td>\n      <td><a href="#" data-idEmail="${t.idEmail}" data-procitan="0\n      " class="izbrisiEmail"><i class="fa fa-trash" aria-hidden="true"></i></a></td>\n      <td><a href="#" data-idEmail="${t.idEmail}"  class="btn btn-outline-secondary detaljiEmail">Detaljnije</a></td>\n      <td><a href="#" data-idEmail="${t.idEmail}" class="btn btn-outline-secondary procitan">Označi da je pročitan</a></td>\n    </tr>\n        `;return e+="</tbody>\n        </table>"}function procitaniMejlovi(a){let i=1,e='<table class="table table-bordered">\n    <thead>\n      <tr>\n        <th scope="col">Redni broj</th>\n        <th scope="col">Email</th>\n        <th scope="col">Svrha poruke</th>\n        <th scope="col">Poruka</th>\n        <th scope="col">Datum</th>\n        <th scope="col">Ažuriraj</th>\n        <th scope="col">Izbriši</th>\n        <th scope="col"><a href="#" id="neprocitanEmail">Prikaži nepročitane</a></th>\n      </tr>\n    </thead>\n    <tbody>';for(let t of a)e+=`\n        <tr>\n      <th scope="row">${i++}</th>\n      <td>${t.email}</td>\n      <td>${t.svrha}</td>\n      <td>${t.poruka}</td>\n      <td>${t.datum}</td>\n      <td><a href="#" data-idEmail="${t.idEmail}" data-procitan="1" \n      class="izbrisiEmail"><i class="fa fa-trash" aria-hidden="true"></i></a></td>\n      <td><a href="#" data-idEmail="${t.idEmail}" class="btn btn-outline-secondary detaljiEmail" >Detaljnije</a></td>\n    </tr>\n        `;return e+="</tbody>\n        </table>"}function prikaziDetaljeEmail(a){a.preventDefault();var i=$(this).data("idemail");$.ajax({url:"modules/email/podaciEmail.php",method:"post",dataType:"json",data:{idEmail:i},success:function(a){$("#detaljiMejla").hide(),$("#detaljiMejla").html(detaljiEmail(a)),$("#detaljiMejla").slideDown(),$("#sakri").click(function(){$("#detaljiMejla").slideUp()})},error:function(a,i,e){var t="Došlo je do greške.";switch(a.status){case 404:t="Stranica nije pronađena.";break;case 500:t=" Greška. "}alert(t)}})}function detaljiEmail(a){return`<table class="table table-bordered">\n    <tbody>\n        <tr>\n      <th scope="row">Email</th>\n      <td>${a.email}</td>\n    </tr>\n    <th scope="row">Svrha poruke</th>\n      <td>${a.svrha}</td>\n      \n    </tr>\n    <th scope="row">Poruka</th>\n      <td>${a.poruka}</td>\n    </tr>\n    <th scope="row">Datum</th>\n      <td>${a.datum}</td>\n    </tr>\n        </tbody>\n        </table>\n        <button type="button" class="btn btn-outline-secondary" id="sakri">Sakri detalje</button>\n        `}function izbrisiEmail(a){a.preventDefault();var i=$(this).data("idemail");console.log(i);var e=parseInt($(this).data("procitan"));console.log(e),$.ajax({url:"modules/email/izbrisiEmail.php",method:"post",dataType:"json",data:{idEmail:i},success:function(a){1==e?prikaziProcitaneEmail():0==e&&ispisNeprocitanihMejlova(),window.location.href="index.php?page=email"},error:function(a,i,e){switch(a.status){case 404:"Stranica nije pronađena.";break;case 500:" Greška. "}window.location.href="index.php?page=email"}})}function procitan(a){a.preventDefault();var i=$(this).data("idemail");console.log(i),$.ajax({url:"modules/email/oznaciDaJeProcitan.php",method:"post",dataType:"json",data:{idEmail:i},success:function(a){ispisNeprocitanihMejlova()},error:function(a,i,e){var t="Došlo je do greške.";switch(a.status){case 404:t="Stranica nije pronađena.";break;case 500:t=" Greška. "}alert(t)}})}$(document).ready(function(){$("#meni>li>ul").hide(),$("#meni>li").mouseenter(function(){$(this).find("ul").stop(!0,!0).slideDown()}),$("#meni>li").mouseleave(function(){$(this).find("ul").stop(!0,!0).slideUp()}),$("#azurirajProizvod").hide(),$("#podaciKorisnik").hide(),-1==url.indexOf("index.php?page=registracija")&&-1==url.indexOf("index.php?page=registracija#")||$("#btnRegistracija").click(regKorisnika),-1==url.indexOf("index.php?page=unos-korisnika")&&-1==url.indexOf("index.php?page=unos-korisnika#")||$("#btnUnos").click(regKorisnika),-1==url.indexOf("index.php?page=korisnici")&&-1==url.indexOf("index.php?page=korisnici#")||ispisiKorisnike(),-1==url.indexOf("index.php?page=proizvodi")&&-1==url.indexOf("index.php?page=proizvodi#")||(sviProizvodi(),stranicenje(0),$("#filterKat").change(function(){let a=$(this).val();$("#sortiranje").val(0),stranicenje(a),$.ajax({url:"modules/proizvodi/filtriranjeSortiranje.php",method:"post",dataType:"json",data:{id:1,idKategorije:a,idZaSort:0,dugme:!0},success:function(a){ispisiProizvode(a)},error:function(a,i,e){var t="Došlo je do greške.";switch(a.status){case 404:t="Stranica nije pronađena.";break;case 500:t=" Greška. "}alert(t)}})}),$("#sortiranje").change(function(){let a=$(this).val(),i=$("#filterKat").val();stranicenje(i),$.ajax({url:"modules/proizvodi/filtriranjeSortiranje.php",method:"post",dataType:"json",data:{id:1,idKategorije:i,idZaSort:a,dugme:!0},success:function(a){ispisiProizvode(a)},error:function(a,i,e){var t="Došlo je do greške.";switch(a.status){case 404:t="Stranica nije pronađena.";break;case 500:t=" Greška. "}alert(t)}})}),$("#stranicenje").on("click",".strana",function(){let a=$(this).data("id"),i=$("#filterKat").val(),e=$("#sortiranje").val();$("#stranicenje2 .active").removeAttr("class"),$(this).parent().attr("class","active"),$.ajax({url:"modules/proizvodi/filtriranjeSortiranje.php",method:"post",dataType:"json",data:{id:a,idKategorije:i,idZaSort:e,dugme:!0},success:function(a){ispisiProizvode(a)},error:function(a,i,e){var t="Došlo je do greške.";switch(a.status){case 404:t="Stranica nije pronađena.";break;case 500:t=" Greška. "}alert(t)}})}),$("#btnSearch").click(function(){let a=$("#tbSearch").val().trim().toUpperCase();""!=a&&$.ajax({url:"modules/proizvodi/search.php",method:"post",dataType:"json",data:{unos:a,dugme:!0},success:function(a){ispisiProizvode(a),$("#stranicenje").hide()},error:function(a,i,e){var t="Došlo je do greške.";switch(a.status){case 404:t="Stranica nije pronađena.";break;case 500:t=" Greška. "}alert(t)}})})),-1==url.indexOf("index.php?page=admin-proizvodi")&&-1==url.indexOf("index.php?page=admin-proizvodi#")||ispisiProizvodeTabelarno(),-1==url.indexOf("index.php?page=kontakt")&&-1==url.indexOf("index.php?page=kontakt#")||$("#btnPosalji").click(function(){let a=$("#tbEmail").val(),i=$("#tbSvrha").val(),e=$("#tbPoruka").val(),t=[];if(/^[a-z][a-z\d\.\-\_]+\@[a-z\d]+(\.[a-z]{2,4})+$/.test(a)?($("#tbEmail").next().html(""),$("#tbEmail").next().removeClass("red")):(t.push("Email nije u dobrom formatu"),$("#tbEmail").next().html("Email nije u dobrom formatu.Primer dijana.radovanovic.10.18@ict.edu.rs"),$("#tbEmail").next().addClass("red")),/^[\d\wžšđčćŽĐŠČĆ\-\.]{5,50}$/.test(i)?($("#tbSvrha").next().html(""),$("#tbSvrha").next().removeClass("red")):(t.push("Svrha poruke nije u dobrom formatu."),$("#tbSvrha").next().html("Svrha poruke nije u dobrom formatu.Može da počne bilo kojim slovo može da sadrži - i . i ima minimalno 5 karaktera."),$("#tbSvrha").next().addClass("red")),""==e?(t.push("Poruka je obavezan podatak"),$("#tbPoruka").next().html("Poruka je obavezan podatak."),$("#tbPoruka").next().addClass("red")):($("#tbPoruka").next().html(""),$("#tbPoruka").next().removeClass("red")),t.length){let a="";for(var o=0;o<t.length;o++)a+=t[o]+"<br/>"}else $.ajax({url:"modules/email/insert.php",method:"post",dataType:"json",data:{email:a,svrha:i,poruka:e,dugme:!0},success:function(a,i,e){$("#poruka").html("Vaša poruka je uspešno poslata"),$("#tbSvrha").val(""),$("#tbEmail").val(""),$("#tbPoruka").val("")},error:function(a,i,e){var t="Došlo je do greške.";switch(a.status){case 404:t="Stranica nije pronađena.";break;case 409:t="Email već postoji. ";break;case 422:t=" Podaci nisu validni. ";break;case 500:t=" Greška. "}$("#poruka").html(t)}})}),-1==url.indexOf("index.php?page=email")&&-1==url.indexOf("index.php?page=email#")||ispisNeprocitanihMejlova()});